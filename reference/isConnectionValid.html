<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en-US"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><title>Checks if a Connection is Valid — isConnectionValid • parallelly</title><!-- favicons --><link rel="icon" type="image/png" sizes="96x96" href="../favicon-96x96.png"><link rel="icon" type="”image/svg+xml”" href="../favicon.svg"><link rel="apple-touch-icon" sizes="180x180" href="../apple-touch-icon.png"><link rel="icon" sizes="any" href="../favicon.ico"><link rel="manifest" href="../site.webmanifest"><script src="../lightswitch.js"></script><script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet"><script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet"><link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet"><script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Checks if a Connection is Valid — isConnectionValid"><meta name="description" content="Get a unique identifier for an R connection
and check whether or not the connection is still valid."><meta property="og:description" content="Get a unique identifier for an R connection
and check whether or not the connection is still valid."><meta property="og:image" content="https://parallelly.futureverse.org/logo.png"><!-- Global site tag (gtag.js) - Google Analytics --><script async src="https://www.googletagmanager.com/gtag/js?id=G-SB3EQSD9FR"></script><script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'G-SB3EQSD9FR');
</script></head><body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top " aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">parallelly</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">1.45.1</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto"><li class="active nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Articles</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-articles"><li><a class="dropdown-item" href="../articles/parallelly-01-intro.html">An Introduction to 'parallelly'</a></li>
    <li><a class="dropdown-item" href="../articles/parallelly-10-local-workers.html">Parallel Workers on the Local Machine</a></li>
    <li><a class="dropdown-item" href="../articles/parallelly-12-remote-workers.html">Parallel Workers on Other Machines</a></li>
    <li><a class="dropdown-item" href="../articles/parallelly-15-cloud-workers.html">Parallel Workers in the Cloud</a></li>
    <li><a class="dropdown-item" href="../articles/parallelly-17-hpc-workers.html">Parallel Workers on High-Performance Compute Environments</a></li>
    <li><a class="dropdown-item" href="../articles/parallelly-20-limit-workers.html">Parallel Workers with CPU and Memory Limited</a></li>
    <li><a class="dropdown-item" href="../articles/parallelly-21-container-workers.html">Parallel Workers Running in Linux Containers</a></li>
    <li><a class="dropdown-item" href="../articles/parallelly-22-wine-workers.html">Parallel Workers Running MS Windows via Wine</a></li>
  </ul></li>
<li class="nav-item"><a class="nav-link" href="../news/index.html">Changelog</a></li>
      </ul><ul class="navbar-nav"><li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json"></form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://www.futureverse.org/"><span class="fa fas fa-home"></span></a></li>
<li class="nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-packages" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Packages</button>
  <ul class="dropdown-menu dropdown-menu-end" aria-labelledby="dropdown-packages"><li><a class="external-link dropdown-item" href="https://doFuture.futureverse.org">doFuture (map-reduce)</a></li>
    <li><a class="external-link dropdown-item" href="https://furrr.futureverse.org">furrr (map-reduce)</a></li>
    <li><a class="external-link dropdown-item" href="https://future.futureverse.org">future</a></li>
    <li><a class="external-link dropdown-item" href="https://future.apply.futureverse.org">future.apply (map-reduce)</a></li>
    <li><a class="external-link dropdown-item" href="https://future.batchtools.futureverse.org">future.batchtools (backend)</a></li>
    <li><a class="external-link dropdown-item" href="https://future.callr.futureverse.org">future.callr (backend)</a></li>
    <li><a class="external-link dropdown-item" href="https://future.mirai.futureverse.org">future.mirai (backend)</a></li>
    <li><a class="external-link dropdown-item" href="https://future.tests.futureverse.org">future.tests</a></li>
    <li><a class="external-link dropdown-item" href="https://globals.futureverse.org">globals</a></li>
    <li><a class="external-link dropdown-item" href="https://listenv.futureverse.org">listenv</a></li>
    <li><a class="dropdown-item" href="https://parallelly.futureverse.org">parallelly</a></li>
    <li><a class="external-link dropdown-item" href="https://progressr.futureverse.org">progressr</a></li>
    <li><a class="external-link dropdown-item" href="https://BiocParallel.FutureParam.futureverse.org">BiocParallel.FutureParam (experimental)</a></li>
    <li><a class="external-link dropdown-item" href="https://future.tools.futureverse.org">future.tools (experimental)</a></li>
    <li><a class="external-link dropdown-item" href="https://future.mapreduce.futureverse.org">future.mapreduce (experimental)</a></li>
    <li><a class="external-link dropdown-item" href="https://marshal.futureverse.org">marshal (experimental)</a></li>
  </ul></li>
<li class="nav-item"><a class="external-link nav-link" href="https://cloud.r-project.org/package=parallelly"><span class="fa fab fa-r-project"></span></a></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/futureverse/parallelly/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
<li class="nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-lightswitch" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true" aria-label="Light switch"><span class="fa fa-sun"></span></button>
  <ul class="dropdown-menu dropdown-menu-end" aria-labelledby="dropdown-lightswitch"><li><button class="dropdown-item" data-bs-theme-value="light"><span class="fa fa-sun"></span> Light</button></li>
    <li><button class="dropdown-item" data-bs-theme-value="dark"><span class="fa fa-moon"></span> Dark</button></li>
    <li><button class="dropdown-item" data-bs-theme-value="auto"><span class="fa fa-adjust"></span> Auto</button></li>
  </ul></li>
      </ul></div>


  </div>
</nav><div class="container template-reference-topic">
<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="../logo.png" class="logo" alt=""><h1>Checks if a Connection is Valid</h1>
      <small class="dont-index">Source: <a href="https://github.com/futureverse/parallelly/blob/HEAD/R/isConnectionValid.R" class="external-link"><code>R/isConnectionValid.R</code></a></small>
      <div class="d-none name"><code>isConnectionValid.Rd</code></div>
    </div>

    <div class="ref-description section level2">
    <p>Get a unique identifier for an R <a href="https://rdrr.io/r/base/connections.html" class="external-link">connection</a>
and check whether or not the connection is still valid.</p>
    </div>

    <div class="section level2">
    <h2 id="ref-usage">Usage<a class="anchor" aria-label="anchor" href="#ref-usage"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span><span class="fu">isConnectionValid</span><span class="op">(</span><span class="va">con</span><span class="op">)</span></span>
<span></span>
<span><span class="fu">connectionId</span><span class="op">(</span><span class="va">con</span><span class="op">)</span></span></code></pre></div>
    </div>

    <div class="section level2">
    <h2 id="arguments">Arguments<a class="anchor" aria-label="anchor" href="#arguments"></a></h2>


<dl><dt id="arg-con">con<a class="anchor" aria-label="anchor" href="#arg-con"></a></dt>
<dd><p>A <a href="https://rdrr.io/r/base/connections.html" class="external-link">connection</a>.</p></dd>

</dl></div>
    <div class="section level2">
    <h2 id="value">Value<a class="anchor" aria-label="anchor" href="#value"></a></h2>
    <p><code>isConnectionValid()</code> returns TRUE if the connection is still valid,
otherwise FALSE.  If FALSE, then character attribute <code>reason</code> provides
an explanation why the connection is not valid.</p>
<p><code>connectionId()</code> returns an non-negative integer, -1, or <code>NA_integer_</code>.
For connections stdin, stdout, and stderr, 0, 1, and 2, are returned,
respectively.  For all other connections, an integer greater or equal to
3 based on the connection's internal pointer is returned.
A connection that has been serialized, which is no longer valid, has
identifier -1.
Attribute <code>raw_id</code> returns the pointer string from which the above is
inferred.</p>
    </div>
    <div class="section level2">
    <h2 id="connection-index-versus-connection-identifier">Connection Index versus Connection Identifier<a class="anchor" aria-label="anchor" href="#connection-index-versus-connection-identifier"></a></h2>


<p>R represents <a href="https://rdrr.io/r/base/connections.html" class="external-link">connections</a> as indices using plain
integers, e.g. <code>idx &lt;- as.integer(con)</code>.
The three connections standard input ("stdin"), standard output ("stdout"),
and standard error ("stderr") always exists and have indices 0, 1, and 2.
Any connection opened beyond these will get index three or greater,
depending on availability as given by <code><a href="https://rdrr.io/r/base/showConnections.html" class="external-link">base::showConnections()</a></code>.
To get the connection with a given index, use <code><a href="https://rdrr.io/r/base/showConnections.html" class="external-link">base::getConnection()</a></code>.
<strong>Unfortunately, this index representation of connections is non-robust</strong>,
e.g. there are cases where two or more 'connection' objects can end up with
the same index and if used, the written output may end up at the wrong
destination and files and database might get corrupted.  This can for
instance happen if <code><a href="https://rdrr.io/r/base/showConnections.html" class="external-link">base::closeAllConnections()</a></code> is used (*).
<strong>In contrast, <code>id &lt;- connectionId(con)</code> gives an identifier that is unique
to that 'connection' object.</strong>  This identifier is based on the internal
pointer address of the object.  The risk for two connections in the same
<span style="R">R</span> session to end up with the same pointer address is very small.
Thus, in case we ended up in a situation where two connections <code>con1</code> and
<code>con2</code> share the same index—<code>as.integer(con1) == as.integer(con2)</code>—
they will never share the same identifier—
<code>connectionId(con1) != connectionId(con2)</code>.
Here, <code>isConnectionValid()</code> can be used to check which one of these
connections, if any, are valid.</p>
<p>(*) Note that there is no good reason for calling <code><a href="https://rdrr.io/r/base/showConnections.html" class="external-link">closeAllConnections()</a></code>
If called, there is a great risk that the files get corrupted etc.
See (1) for examples and details on this problem.
If you think there is a need to use it, it is much safer to restart <span style="R">R</span>
because that is guaranteed to give you a working <span style="R">R</span> session with
non-clashing connections.
It might also be that <code><a href="https://rdrr.io/r/base/showConnections.html" class="external-link">closeAllConnections()</a></code> is used because
<code><a href="https://rdrr.io/r/base/base-internal.html" class="external-link">base::sys.save.image()</a></code> is called, which might happen if <span style="R">R</span> is being
forced to terminate.</p>
    </div>
    <div class="section level2">
    <h2 id="connections-cannot-be-serialized-or-saved">Connections Cannot be Serialized Or Saved<a class="anchor" aria-label="anchor" href="#connections-cannot-be-serialized-or-saved"></a></h2>


<p>A 'connection' cannot be serialized, e.g. it cannot be saved to file to
be read and used in another <span style="R">R</span> session.  If attempted, the connection will
not be valid.  This is a problem that may occur in parallel processing
when passing an <span style="R">R</span> object to parallel worker for further processing, e.g.
the exported object may hold an internal database connection which will
no longer be valid on the worker.
When a connection is serialized, its internal pointer address will be
invalidated (set to nil). In such cases, <code>connectionId(con)</code> returns -1
and <code>isConnectionValid(con)</code> returns FALSE.</p>
    </div>
    <div class="section level2">
    <h2 id="references">References<a class="anchor" aria-label="anchor" href="#references"></a></h2>

<ol><li><p><a href="https://github.com/HenrikBengtsson/Wishlist-for-R/issues/81" class="external-link">'BUG: A <code>connection</code> object may become corrupt and re-referenced to another connection (PATCH)'</a>, 2018-10-30.</p></li>
<li><p>R-devel thread <a href="https://stat.ethz.ch/pipermail/r-devel/2018-October/077004.html" class="external-link">PATCH: Asserting that 'connection' used has not changed + R_GetConnection2()</a>, 2018-10-31.</p></li>
</ol></div>
    <div class="section level2">
    <h2 id="see-also">See also<a class="anchor" aria-label="anchor" href="#see-also"></a></h2>
    <div class="dont-index"><p>See <code><a href="https://rdrr.io/r/base/showConnections.html" class="external-link">base::showConnections()</a></code> for currently open connections and their
indices. To get a connection by its index, use <code><a href="https://rdrr.io/r/base/showConnections.html" class="external-link">base::getConnection()</a></code>.</p></div>
    </div>

    <div class="section level2">
    <h2 id="ref-examples">Examples<a class="anchor" aria-label="anchor" href="#ref-examples"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span class="r-in"><span><span class="co">## R represents connections as plain indices</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/base/integer.html" class="external-link">as.integer</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/showConnections.html" class="external-link">stdin</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span>          <span class="co">## int 0</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [1] 0</span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/base/integer.html" class="external-link">as.integer</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/showConnections.html" class="external-link">stdout</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span>         <span class="co">## int 1</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [1] 3</span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/base/integer.html" class="external-link">as.integer</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/showConnections.html" class="external-link">stderr</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span>         <span class="co">## int 2</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [1] 2</span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co">## The first three connections always exist and are always valid</span></span></span>
<span class="r-in"><span><span class="fu">isConnectionValid</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/showConnections.html" class="external-link">stdin</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span>   <span class="co">## TRUE</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [1] TRUE</span>
<span class="r-in"><span><span class="fu">connectionId</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/showConnections.html" class="external-link">stdin</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span>        <span class="co">## 0L</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [1] 0</span>
<span class="r-in"><span><span class="fu">isConnectionValid</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/showConnections.html" class="external-link">stdout</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span>  <span class="co">## TRUE</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [1] FALSE</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> attr(,"reason")</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [1] "Connection (connection: index=3, description=\"\", class=\"file\", mode=\"w+b\", text=\"binary\", opened=\"opened\", can read=\"yes\", can write=\"yes\", id=NA) is no longer valid. It differ from the currently registered R connection with the same index 3 (connection: index=3, description=\"\", class=\"file\", mode=\"w+b\", text=\"binary\", opened=\"opened\", can read=\"yes\", can write=\"yes\", id=1425, raw_id=\"&lt;pointer: 0x591&gt;\")"</span>
<span class="r-in"><span><span class="fu">connectionId</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/showConnections.html" class="external-link">stdout</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span>       <span class="co">## 1L</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [1] NA</span>
<span class="r-in"><span><span class="fu">isConnectionValid</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/showConnections.html" class="external-link">stderr</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span>  <span class="co">## TRUE</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [1] TRUE</span>
<span class="r-in"><span><span class="fu">connectionId</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/showConnections.html" class="external-link">stderr</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span>       <span class="co">## 2L</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [1] 2</span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co">## Connections cannot be serialized</span></span></span>
<span class="r-in"><span><span class="va">con</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/connections.html" class="external-link">file</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/tempfile.html" class="external-link">tempfile</a></span><span class="op">(</span><span class="op">)</span>, open <span class="op">=</span> <span class="st">"w"</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">x</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>value <span class="op">=</span> <span class="fl">42</span>, stderr <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/showConnections.html" class="external-link">stderr</a></span><span class="op">(</span><span class="op">)</span>, con <span class="op">=</span> <span class="va">con</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">y</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/serialize.html" class="external-link">unserialize</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/serialize.html" class="external-link">serialize</a></span><span class="op">(</span><span class="va">x</span>, connection <span class="op">=</span> <span class="cn">NULL</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="fu">isConnectionValid</span><span class="op">(</span><span class="va">y</span><span class="op">$</span><span class="va">stderr</span><span class="op">)</span>  <span class="co">## TRUE</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [1] TRUE</span>
<span class="r-in"><span><span class="fu">connectionId</span><span class="op">(</span><span class="va">y</span><span class="op">$</span><span class="va">stderr</span><span class="op">)</span>       <span class="co">##  2L</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [1] 2</span>
<span class="r-in"><span><span class="fu">isConnectionValid</span><span class="op">(</span><span class="va">y</span><span class="op">$</span><span class="va">con</span><span class="op">)</span>     <span class="co">## FALSE with attribute 'reason'</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [1] FALSE</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> attr(,"reason")</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [1] "Connection (connection: index=4, description=\"/tmp/henrik/RtmpB6EgTp/file10c6e057a8174b\", class=\"file\", mode=\"w\", text=\"text\", opened=\"opened\", can read=\"no\", can write=\"yes\", id=-1) is no longer valid. It differ from the currently registered R connection with the same index 4 (connection: index=4, description=\"/tmp/henrik/RtmpB6EgTp/file10c6e057a8174b\", class=\"file\", mode=\"w\", text=\"text\", opened=\"opened\", can read=\"no\", can write=\"yes\", id=1427, raw_id=\"&lt;pointer: 0x593&gt;\")"</span>
<span class="r-in"><span><span class="fu">connectionId</span><span class="op">(</span><span class="va">y</span><span class="op">$</span><span class="va">con</span><span class="op">)</span>          <span class="co">## -1L</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [1] -1</span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/base/connections.html" class="external-link">close</a></span><span class="op">(</span><span class="va">con</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
</code></pre></div>
    </div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside></div>


    <footer><div class="pkgdown-footer-left">
  <p>Developed by Henrik Bengtsson.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.3</p> and <a href="https://github.com/HenrikBengtsson/pkgdown.extras/">pkgdown.extras</a> 0.0.0.9007.</p>
</div>

    </footer></div>





  </body></html>

